<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test de Connexion n8n</title>
    <style>
        body { font-family: sans-serif; background: #222; color: white; text-align: center; padding-top: 50px; }
        h1 { color: #00ff99; }
        button { font-size: 20px; padding: 15px 30px; cursor: pointer; }
        #log { margin-top: 30px; background: #333; padding: 20px; text-align: left; }
    </style>
</head>
<body>

    <h1>Fichier de Test Ultime v3</h1>
    <p>Ce test va essayer de contacter ton n8n sur Hugging Face.</p>
    
    <input type="file" id="testFile">
    <button id="testButton">Lancer le Test</button>

    <div id="log">Logs du test :</div>

    <script>
        const testButton = document.getElementById('testButton');
        const testFile = document.getElementById('testFile');
        const logDiv = document.getElementById('log');

        function log(message) {
            console.log(message);
            logDiv.innerHTML += `<p>> ${message}</p>`;
        }

        testButton.addEventListener('click', async () => {
            const webhookUrl = "https://kevin2343-mon-n8n-transformer.hf.space/workflow/TtlpK2Ht4TESFE8s";
            const file = testFile.files[0];

            if (!file) {
                log("ERREUR : Veuillez d'abord sélectionner un fichier.");
                return;
            }

            log("Bouton cliqué. Préparation de l'envoi...");
            log(`URL de destination : ${webhookUrl}`);

            try {
                const formData = new FormData();
                formData.append('video', file, file.name);
                
                log("Envoi de la requête en cours... (fetch)");
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    body: formData
                });

                log(`Réponse reçue du serveur ! Statut : ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log("SUCCÈS ! Données reçues :");
                    log(JSON.stringify(data));
                } else {
                    log(`ERREUR : Le serveur a répondu avec un statut ${response.status}.`);
                }

            } catch (error) {
                log("ERREUR CRITIQUE : Impossible d'envoyer la requête (Failed to fetch).");
                log(`Détail de l'erreur : ${error}`);
            }
        });
    </script>
</body>
</html>
